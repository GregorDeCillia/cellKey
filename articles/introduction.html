<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to the cellKey-Package • cellKey</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to the cellKey-Package">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">cellKey</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.17</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/introduction.html">Introduction to the cellKey-Package</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Introduction to the cellKey-Package</h1>
                        <h4 class="author">Bernhard Meindl</h4>
            
            <h4 class="date">2019-06-18</h4>
      
      
      <div class="hidden name"><code>introduction.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>This package implements methods to provide perturbation for statistical tables. The implementation if greatly inspired by the the paper <em>Methodology for the Automatic Confidentialisation of Statistical Outputs from Remote Servers at the Australian Bureau of Statistics</em> (Thompson, Broadfoot, Elazar). This approach however was generalized and a new specification on how record keys are specified and the lookup-tables are defined is used. This package makes usage of perturbation tables that can be defined in the <a href="https://github.com/sdcTools/ptable"><strong>ptable</strong></a> package. This document describes the usage of version <code>0.17</code> of the package.</p>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>Package <a href="https://github.com/sdcTools/cellKey"><strong>cellKey</strong></a> is not yet on <code>CRAN</code> and thus needs to be installed from source. The following code gives instructions on how to install the latest version of the package directly from <a href="https://www.github.com"><strong>github.com</strong></a>:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="co"># update your R installation</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/utils/update.packages.html">update.packages</a></span>(<span class="dt">ask =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="co"># install cellKey from github.com</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="cf">if</span> (<span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/ns-load.html">requireNamespace</a></span>(<span class="st">"remotes"</span>, <span class="dt">quietly =</span> <span class="ot">TRUE</span>)) {</a>
<a class="sourceLine" id="cb1-6" data-line-number="6">  <span class="kw"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"remotes"</span>)</a>
<a class="sourceLine" id="cb1-7" data-line-number="7">}</a>
<a class="sourceLine" id="cb1-8" data-line-number="8">remotes<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/remotes/man/install_github.html">install_github</a></span>(</a>
<a class="sourceLine" id="cb1-9" data-line-number="9">  <span class="dt">repo =</span> <span class="st">"sdcTools/cellKey"</span>,</a>
<a class="sourceLine" id="cb1-10" data-line-number="10">  <span class="dt">dependencies =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb1-11" data-line-number="11">  <span class="dt">build_opts =</span> <span class="st">"--no-resave-data"</span>,</a>
<a class="sourceLine" id="cb1-12" data-line-number="12">  <span class="dt">force =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb1-13" data-line-number="13">)</a></code></pre></div>
</div>
<div id="main-features" class="section level2">
<h2 class="hasAnchor">
<a href="#main-features" class="anchor"></a>Main Features</h2>
<p>In the <strong>cellKey</strong> package it is possible to pertub multidimensional count and magnitude tables. Functionality to generate suitable record keys is provided in function <code><a href="../reference/ck_generate_rkeys.html">ck_generate_rkeys()</a></code>. Using sha1-checksums on the input datasets, we can make sure that the same record keys are generated whenever the same input data set is used for which record keys should be generated. However, it is also possible of course to use already pre-generated record keys available as variable in the microdata set.</p>
<p>The package allows to make use of sampling weights. Thus, both weighted and unweighted count and magnitude tables can be perturbed. The hierarchical structure of the variables spanning the table can be arbitrarily complex. To generate these hierarchies, the <strong>cellKey</strong> packages depends on functionality available in package <a href="https://cran.r-project.org/package=sdcHierarchies"><strong>sdcHierarchies</strong></a>. Finally, auxiliary methods are provided that allow to extract valueable information from objects created by the main function of this package <code>perturbTable()</code>. For example <code>mod_counts()</code> returns a data object showing for each cell the perturbation value and where it was found in the lookup table.</p>
<p>What is left is of course identifying bugs and issues and also to optimize performance of the package as well as to include some real world examples, eg. census tables.</p>
</div>
<div id="an-example" class="section level2">
<h2 class="hasAnchor">
<a href="#an-example" class="anchor"></a>An Example</h2>
<p>We now show the capabilities of the <strong>cellKey</strong> package by running an example that</p>
<div id="load-the-package" class="section level3">
<h3 class="hasAnchor">
<a href="#load-the-package" class="anchor"></a>Load the Package</h3>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(cellKey)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/utils/packageDescription.html">packageVersion</a></span>(<span class="st">"cellKey"</span>)</a></code></pre></div>
<pre><code>## [1] '0.17'</code></pre>
<p>The first step in this approach is to generate a statistical table, which can be achieved using <code>ck_setup</code>. This function generates an object that contains all the information required to perturb count- (and optionally continuously scaled) variables. There are however a few inputs that <code><a href="../reference/cellkey_pkg.html">ck_setup()</a></code> requires and that need to be generated beforehand. These inputs are:</p>
<ul>
<li>
<code>x</code>: a <code>data.frame</code> or <code>data.table</code> containing microdata</li>
<li>
<code>rkey</code>: defines where to find or how to compute record keys. It is possible to either specify a scalar character name or a number. If a number is specified, record keys are internally created by sampling from a uniform distribution between 0 and 1 with the random numbers rounded to the specified value of digits. If a name is specified, this name is interpreted as a variable name within <code>x</code> already containing record keys.</li>
<li>
<code>dims</code>: a named list where each list element contains a hierarchy created with functionality from package <a href="ttps://cran.r-project.org/package=sdcHierarchies"><strong>sdcHierarchies</strong></a> and each name refers to a variable in <code>x</code>
</li>
<li>
<code>w</code>: either <code>NULL</code> (no weights) or the name of a variable in <code>x</code> that contains weights</li>
<li>
<code>countvars</code>: an optional character vector of variables in <code>x</code> holding counts. In any case a special count variable <code>total</code> is internally generated that is <code>1</code> for each row of <code>x</code>
</li>
<li>
<code>params_cnts</code>: an object containing perturbation parameters relevant to <code>countvars</code> that needs to be created using <code><a href="../reference/ck_params_cnts.html">ck_params_cnts()</a></code>.</li>
</ul>
<p>We now show how to generate the required inputs. The first step is to prepare the inputdata.</p>
</div>
<div id="specifying-inputdata" class="section level3">
<h3 class="hasAnchor">
<a href="#specifying-inputdata" class="anchor"></a>Specifying inputdata</h3>
<p>The testdata set we are using in this example contains information on person-level along with sampling weights as well as some categorical and continuously scaled variables. We also compute some binary variables for which we also want to create perturbed tables.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">dat &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ck_create_testdata.html">ck_create_testdata</a></span>()</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">dat &lt;-<span class="st"> </span>dat[, <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"sex"</span>, <span class="st">"age"</span>, <span class="st">"savings"</span>, <span class="st">"income"</span>, <span class="st">"sampling_weight"</span>)]</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">dat[, cnt_males <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(sex <span class="op">==</span><span class="st"> "male"</span>, <span class="dv">1</span>, <span class="dv">0</span>)]</a>
<a class="sourceLine" id="cb4-4" data-line-number="4">dat[, cnt_highincome <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(income <span class="op">&gt;=</span><span class="st"> </span><span class="dv">9000</span>, <span class="dv">1</span>, <span class="dv">0</span>)]</a></code></pre></div>
<p>We are now adding record keys with 7 digits to the data set that are going to be used later using function <code>ck_generate_rkeys</code> as shown below:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">dat<span class="op">$</span>rkeys &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ck_generate_rkeys.html">ck_generate_rkeys</a></span>(<span class="dt">dat =</span> dat, <span class="dt">nr_digits =</span> <span class="dv">7</span>)</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(dat))</a></code></pre></div>
<pre><code>##       sex        age savings income sampling_weight cnt_males
## 1:   male age_group3      12   5780              29         1
## 2: female age_group3      28   2530              43         0
## 3:   male age_group1     550   6920              95         1
## 4:   male age_group1     870   7960              54         1
## 5:   male age_group4      20   9030              86         1
## 6: female age_group3     102   3290              82         0
##    cnt_highincome     rkeys
## 1:              0 0.1687290
## 2:              0 0.7196917
## 3:              0 0.0263095
## 4:              0 0.5659745
## 5:              1 0.7882672
## 6:              0 0.2286856</code></pre>
<p>To ensure that the same record keys are computed each and every time for the same data set, a seed based on the sha1-hash of the input dataset is computed and used before drawing the record keys.</p>
<p>The goal of this introduction is to create a perturbed table of counts of variables <code>sex</code> by <code>age</code> for all observations as well as for the subgroups in <code>cnt_males</code> and <code>cnt_highincome</code> that are non-zero. We also want to create perturbed tables of continously scaled variables <code>savings</code> and <code>income</code> also giving the hierarchical structure defined by <code>sex</code> by <code>age</code>.</p>
</div>
<div id="specifying-dimensions" class="section level3">
<h3 class="hasAnchor">
<a href="#specifying-dimensions" class="anchor"></a>Specifying dimensions</h3>
<p>It is required to define hierarchies for each of the classifying variables of the desired table. There are two ways how the hierarchical structure of these variables (including sub-totals) can be specified. One way is to use <code>"@; value</code> format as (also) used in <a href="ttps://cran.r-project.org/package=sdcTable"><strong>sdcTable</strong></a>. We would suggest however, to use the second alternative which is using functionality from package <a href="ttps://cran.r-project.org/package=sdcHierarchies"><strong>sdcHierarchies</strong></a>. In this vignette, we only show the preferred way to generate hierarchies for categorical variables <code>age</code> and <code>sex</code> below:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">dim_sex &lt;-<span class="st"> </span><span class="kw">hier_create</span>(<span class="dt">root =</span> <span class="st">"Total"</span>, <span class="dt">nodes =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"male"</span>, <span class="st">"female"</span>))</a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="kw">hier_display</span>(dim_sex)</a></code></pre></div>
<pre><code>## Total
## ├─female
## └─male</code></pre>
<p>For variable <code>age</code> the process is very much the same:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">dim_age &lt;-<span class="st"> </span><span class="kw">hier_create</span>(<span class="dt">root =</span> <span class="st">"Total"</span>, <span class="dt">nodes =</span> <span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"age_group"</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">6</span>))</a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="kw">hier_display</span>(dim_age)</a></code></pre></div>
<pre><code>## Total
## ├─age_group1
## ├─age_group2
## ├─age_group3
## ├─age_group4
## ├─age_group5
## └─age_group6</code></pre>
<p>The idea of <a href="https://github.com/bernhard-da/sdcHierarchies"><strong>sdcHierarchy</strong></a> is to create a tree object using <code>hier_create()</code> and then add (using <code>hier_add()</code>), delete (with <code>hier_delete()</code>) or rename (using <code>hier_rename()</code>) elements from this hierarchical structure. For more examples have a look at the package vignette of the package which can be accessed with <code><a href="https://rdrr.io/pkg/sdcHierarchies/man/hier_vignette.html">sdcHierarchies::hier_vignette()</a></code>. <a href="https://github.com/bernhard-da/sdcHierarchies"><strong>sdcHierarchy</strong></a> also contains a shiny-based app that can be called with <code>hier_app()</code> which allows to interactively change and modify a hierarchy and allows to convert tree- and data.frame based inputs into various formats. For more information, have a look at <code>?hier_app</code> and the other help-files of the package.</p>
<p>After all dimensions have been specified, these inputs must then be combined into a named list. In this object, the list-names refer to variable names of the input data set and the elements the data objects that hold the hierarchy specification itself. This is why the list elements of <code>dims</code> in this example have to be named <code>sex</code> and <code>age</code> as the specification refers to variables <code>age</code> and <code>sex</code> in input set <code>dat</code>.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">dims &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">sex =</span> dim_sex, <span class="dt">age =</span> dim_age)</a></code></pre></div>
</div>
<div id="define-perturbation-parameters-for-count-variables" class="section level3">
<h3 class="hasAnchor">
<a href="#define-perturbation-parameters-for-count-variables" class="anchor"></a>Define perturbation parameters for count variables</h3>
<p>The next task is to define parameters that are used to perturb count variables which can be archieved using function <code>ck_params_cnts</code>. This function wraps <code>pt_create_pTable</code> from the <a href="https://github.com/sdcTools/ptable"><strong>ptable</strong></a> package, so for the parameters have a look at the help page for this function. A typical application is shown below:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">params_cnts &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ck_params_cnts.html">ck_params_cnts</a></span>(</a>
<a class="sourceLine" id="cb12-2" data-line-number="2">  <span class="dt">D =</span> <span class="dv">5</span>,</a>
<a class="sourceLine" id="cb12-3" data-line-number="3">  <span class="dt">V =</span> <span class="dv">3</span>,</a>
<a class="sourceLine" id="cb12-4" data-line-number="4">  <span class="dt">js =</span> <span class="dv">2</span>,</a>
<a class="sourceLine" id="cb12-5" data-line-number="5">  <span class="dt">pstay =</span> <span class="fl">0.5</span>,</a>
<a class="sourceLine" id="cb12-6" data-line-number="6">  <span class="dt">optim =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb12-7" data-line-number="7">  <span class="dt">mono =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb12-8" data-line-number="8">)</a></code></pre></div>
<p>The output of <code>ck_params_cnts</code> is an object that can be directly used in <code><a href="../reference/cellkey_pkg.html">ck_setup()</a></code> as we will see later.</p>
</div>
<div id="define-perturbation-parameters-for-continuous-variables" class="section level3">
<h3 class="hasAnchor">
<a href="#define-perturbation-parameters-for-continuous-variables" class="anchor"></a>Define perturbation parameters for continuous variables</h3>
<p>Future versions of <code>cellKey</code> will allow to perturb continuous variables as well. This is however not yet implemented.</p>
</div>
<div id="setup-a-table-instance" class="section level3">
<h3 class="hasAnchor">
<a href="#setup-a-table-instance" class="anchor"></a>Setup a table instance</h3>
<p>We now have prepared the inputs and can define a generic statistical table using <code><a href="../reference/cellkey_pkg.html">ck_setup()</a></code> as shown below:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">tab &lt;-<span class="st"> </span><span class="kw"><a href="../reference/cellkey_pkg.html">ck_setup</a></span>(</a>
<a class="sourceLine" id="cb13-2" data-line-number="2">  <span class="dt">x =</span> dat,</a>
<a class="sourceLine" id="cb13-3" data-line-number="3">  <span class="dt">rkey =</span> <span class="st">"rkeys"</span>,</a>
<a class="sourceLine" id="cb13-4" data-line-number="4">  <span class="dt">dims =</span> dims,</a>
<a class="sourceLine" id="cb13-5" data-line-number="5">  <span class="dt">w =</span> <span class="st">"sampling_weight"</span>,</a>
<a class="sourceLine" id="cb13-6" data-line-number="6">  <span class="dt">countvars =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"cnt_males"</span>, <span class="st">"cnt_highincome"</span>),</a>
<a class="sourceLine" id="cb13-7" data-line-number="7">  <span class="dt">params_cnts =</span> params_cnts</a>
<a class="sourceLine" id="cb13-8" data-line-number="8">)</a></code></pre></div>
<p><code><a href="../reference/cellkey_pkg.html">ck_setup()</a></code> returns a <code>R6</code> class object that contains not only the relevant data but also all available methods. Thus, it is not required to assign the results of such methods to new objects, instead, the object itself is automatically updated.</p>
<p>These objects also have a custom print method, showing some general information about the object:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(tab)</a></code></pre></div>
<pre><code>## ── Table Information ──────────────────────────────────────────────────────
## ✔ 21 cells in 2 dimensions ('sex', 'age')
## ✔ weights: yes
## ── Tabulated / Perturbed countvars ────────────────────────────────────────
## ☐ 'total'
## ☐ 'cnt_males'
## ☐ 'cnt_highincome'</code></pre>
</div>
<div id="compute-perturbed-tables" class="section level3">
<h3 class="hasAnchor">
<a href="#compute-perturbed-tables" class="anchor"></a>Compute perturbed tables</h3>
<p>It is now possible to finally perturbed variables using the <code>perturb()</code>-method. As <code>tab</code> - the object created with <code><a href="../reference/cellkey_pkg.html">ck_setup()</a></code> - already contains all possible data, the only required input is the name of a variable that should be perturbed.</p>
<ul>
<li>
<code>v</code>: a character vector specifying one or more variables that should be perturbed.</li>
</ul>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1">tab<span class="op">$</span><span class="kw">perturb</span>(<span class="dt">v =</span> <span class="st">"total"</span>)</a></code></pre></div>
<pre><code>## Count variable 'total' was perturbed.</code></pre>
<p>After this call, object <code>tab</code> is updated and contains now also perturbed values for variable <code>total</code>. We note that no explicit assignment is required.</p>
</div>
<div id="modify-perturbation-parameters" class="section level3">
<h3 class="hasAnchor">
<a href="#modify-perturbation-parameters" class="anchor"></a>Modify perturbation parameters</h3>
<p>Using method <code><a href="../reference/params_cnts.html">params_cnts()</a></code> it is possible to modify the current set perturbation parameters. This is useful if one wants to use different perturbation inputs for different variables. We now show how to replace the current perturbation input for count variables. The first step is to create a new object containing perturbation parameters using <code><a href="../reference/ck_params_cnts.html">ck_params_cnts()</a></code>.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1">params_cnts2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ck_params_cnts.html">ck_params_cnts</a></span>(</a>
<a class="sourceLine" id="cb18-2" data-line-number="2">  <span class="dt">D =</span> <span class="dv">8</span>,</a>
<a class="sourceLine" id="cb18-3" data-line-number="3">  <span class="dt">V =</span> <span class="dv">10</span>,</a>
<a class="sourceLine" id="cb18-4" data-line-number="4">  <span class="dt">js =</span> <span class="dv">4</span></a>
<a class="sourceLine" id="cb18-5" data-line-number="5">)</a></code></pre></div>
<p>Updating/replacing the perturbation parameters can then be achieved as shown below:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1">tab<span class="op">$</span><span class="kw"><a href="../reference/params_cnts.html">params_cnts</a></span>(params_cnts2)</a></code></pre></div>
<pre><code>## Perturbation parameters for count variables were modified.</code></pre>
<p>From now on, these parameters will be used to perturb any count variables.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1">tab<span class="op">$</span><span class="kw">perturb</span>(<span class="dt">v =</span> <span class="st">"cnt_males"</span>)</a></code></pre></div>
<pre><code>## Count variable 'cnt_males' was perturbed.</code></pre>
<p>A <code>data.table</code> containing original and perturbed values can now be extracted using the <code>freqtab()</code>-method as discussed next.</p>
</div>
<div id="extract-perturbed-tables" class="section level3">
<h3 class="hasAnchor">
<a href="#extract-perturbed-tables" class="anchor"></a>Extract perturbed tables</h3>
<p>Applying the <code>freqtab()</code>-methods to one ore more already perturbed variables returns a <code>data.table</code> that contains for each table cell the unpertubed and perturbed (weighted and/or unweighted) counts. This function has the following arguments:</p>
<ul>
<li>
<code>v</code>: one or more variable names of already perturbed count variables</li>
<li>
<code>type</code>: a scalar character defining what variables should be included in the result. Possible choices are <code>"both"</code> (the default), <code>"weighted"</code> and <code>"unweighted"</code>
</li>
<li>
<code>path</code>: if not <code>NULL</code>, a (relative or absolute) path to which the resulting output table should be written. A <code>csv</code> file will be generated and <code>.csv</code> will be appended to the value provided.</li>
</ul>
<p>The method returns a <code>data.table</code> with all combinations of the dimensional variables in the first <span class="math inline">\(n\)</span> colums and after those, all (or some) of the following columns:</p>
<ul>
<li>
<code>vname</code>: name of the perturbed variable (always included)</li>
<li>
<code>uwc</code>: unweighted counts (if <code>type</code> is <code>"both"</code> or <code>"unweighted"</code>)</li>
<li>
<code>wc</code>: weighted counts (if <code>type</code> is <code>"both"</code> or <code>"weighted"</code>)</li>
<li>
<code>puwc</code>: perturbed unweighted counts (if <code>type</code> is <code>"both"</code> or <code>"unweighted"</code>)</li>
<li>
<code>pwc</code>: perturbed weighted counts (if <code>type</code> is <code>"both"</code> or <code>"weighted"</code>)</li>
</ul>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1">tab<span class="op">$</span><span class="kw">freqtab</span>(<span class="dt">v =</span> <span class="st">"total"</span>, <span class="dt">type =</span> <span class="st">"both"</span>)</a></code></pre></div>
<pre><code>##        sex        age vname  uwc     wc puwc        pwc
##  1:  Total      Total total 4580 275235 4580 4640.09498
##  2:  Total age_group1 total 1969 118295 1969 2029.07872
##  3:  Total age_group2 total 1143  68235 1143 1202.69816
##  4:  Total age_group3 total  864  52299  864  924.53125
##  5:  Total age_group4 total  423  25521  423  483.33333
##  6:  Total age_group5 total  168  10236  167  227.92857
##  7:  Total age_group6 total   13    649   13   62.92308
##  8: female      Total total 2284 139198 2281 2341.94483
##  9: female age_group1 total  954  58142  955 1015.94549
## 10: female age_group2 total  572  34832  571  631.89510
## 11: female age_group3 total  440  26953  439  500.25682
## 12: female age_group4 total  228  14098  229  290.83333
## 13: female age_group5 total   84   4888   85  143.19048
## 14: female age_group6 total    6    285    6   53.50000
## 15:   male      Total total 2296 136037 2296 2355.24956
## 16:   male age_group1 total 1015  60153 1016 1075.26404
## 17:   male age_group2 total  571  33403  570  628.49912
## 18:   male age_group3 total  424  25346  424  483.77830
## 19:   male age_group4 total  195  11423  198  256.57949
## 20:   male age_group5 total   84   5348   84  147.66667
## 21:   male age_group6 total    7    364    7   59.00000
##        sex        age vname  uwc     wc puwc        pwc</code></pre>
<p>To query only the weighted unperturbed and perturbed counts for <code>total</code> and <code>cnt_males</code>, one could use the following code:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1">tab<span class="op">$</span><span class="kw">freqtab</span>(<span class="dt">v =</span> <span class="st">"total"</span>, <span class="dt">type =</span> <span class="st">"weighted"</span>)</a></code></pre></div>
<pre><code>##        sex        age vname     wc        pwc
##  1:  Total      Total total 275235 4640.09498
##  2:  Total age_group1 total 118295 2029.07872
##  3:  Total age_group2 total  68235 1202.69816
##  4:  Total age_group3 total  52299  924.53125
##  5:  Total age_group4 total  25521  483.33333
##  6:  Total age_group5 total  10236  227.92857
##  7:  Total age_group6 total    649   62.92308
##  8: female      Total total 139198 2341.94483
##  9: female age_group1 total  58142 1015.94549
## 10: female age_group2 total  34832  631.89510
## 11: female age_group3 total  26953  500.25682
## 12: female age_group4 total  14098  290.83333
## 13: female age_group5 total   4888  143.19048
## 14: female age_group6 total    285   53.50000
## 15:   male      Total total 136037 2355.24956
## 16:   male age_group1 total  60153 1075.26404
## 17:   male age_group2 total  33403  628.49912
## 18:   male age_group3 total  25346  483.77830
## 19:   male age_group4 total  11423  256.57949
## 20:   male age_group5 total   5348  147.66667
## 21:   male age_group6 total    364   59.00000
##        sex        age vname     wc        pwc</code></pre>
</div>
<div id="computing-utility-measures-for-count-variables" class="section level3">
<h3 class="hasAnchor">
<a href="#computing-utility-measures-for-count-variables" class="anchor"></a>Computing utility measures for count variables</h3>
<p>Method <code>measures()</code> allows to compute information loss measures for perturbed count variables. Its application is as simple as:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1">tab<span class="op">$</span><span class="kw">measures</span>(<span class="dt">v =</span> <span class="st">"total"</span>)</a></code></pre></div>
<pre><code>## $overview
##    noise cnt        pct
## 1:    -3   1 0.04761905
## 2:    -1   4 0.19047619
## 3:     0  11 0.52380952
## 4:     1   4 0.19047619
## 5:     3   1 0.04761905
## 
## $measures
##       what    d1    d2    d3
##  1:    Min 0.000 0.000 0.000
##  2:    Q10 0.000 0.000 0.000
##  3:    Q20 0.000 0.000 0.000
##  4:    Q30 0.000 0.000 0.000
##  5:    Q40 0.000 0.000 0.000
##  6:   Mean 0.667 0.002 0.017
##  7: Median 0.000 0.000 0.000
##  8:    Q60 1.000 0.001 0.016
##  9:    Q70 1.000 0.002 0.021
## 10:    Q80 1.000 0.002 0.031
## 11:    Q90 1.000 0.006 0.039
## 12:    Q95 3.000 0.012 0.054
## 13:    Q99 3.000 0.015 0.096
## 14:    Max 3.000 0.015 0.107
## 
## $cumdistr_d1
##    cat cnt       pct
## 1:   0  11 0.5238095
## 2:   1  19 0.9047619
## 3:   3  21 1.0000000
## 
## $cumdistr_d2
##            cat cnt pct
## 1:    [0,0.02]  21   1
## 2: (0.02,0.05]  21   1
## 3:  (0.05,0.1]  21   1
## 4:   (0.1,0.2]  21   1
## 5:   (0.2,0.3]  21   1
## 6:   (0.3,0.4]  21   1
## 7:   (0.4,0.5]  21   1
## 8:   (0.5,Inf]  21   1
## 
## $cumdistr_d3
##            cat cnt       pct
## 1:    [0,0.02]  13 0.6190476
## 2: (0.02,0.05]  19 0.9047619
## 3:  (0.05,0.1]  20 0.9523810
## 4:   (0.1,0.2]  21 1.0000000
## 5:   (0.2,0.3]  21 1.0000000
## 6:   (0.3,0.4]  21 1.0000000
## 7:   (0.4,0.5]  21 1.0000000
## 8:   (0.5,Inf]  21 1.0000000
## 
## $false_zero
## [1] 0
## 
## $false_nonzero
## [1] 0</code></pre>
<p>This function returns a list with several utility measures that are now discussed. For further information have a look at <code><a href="../reference/ck_cnt_measures.html">?ck_cnt_measures</a></code> as the same set of measures can also be computed for two vectors containing original and perturbed values.</p>
<ul>
<li>
<code>overview</code>: a <code>data.table</code> with the following three columns:
<ul>
<li>noise: amount of noise computed as orig - pert</li>
<li>cnt: number of cells perturbed with the value given in column noise</li>
<li>pct: percentage of cells perturbed with the value given in column noise</li>
</ul>
</li>
<li>
<code>measures</code>: a <code>data.table</code> containing measures of the distribution of three different distances between original and perturbed values of the unweighted counts. Column <code>what</code> specifies the computed measure. The three distances considered are:
<ul>
<li>
<code>d1</code>: absolute distance between original and masked values</li>
<li>
<code>d2</code>: relative absolute distance between original and masked values</li>
<li>
<code>d3</code>: absolute distance between square-roots of original and perturbed values</li>
</ul>
</li>
<li>
<code>cumdistr_d1</code>, <code>cumdistr_d2</code> and <code>cumdistr_d3</code>: for each distance d1, d2 and d3, a data.table with the following three columns:
<ul>
<li>
<code>cat</code>: a specific value (for d1) or interval (for distances d2 and d3)</li>
<li>
<code>cnt</code>: number of records smaller or equal the value in column cat for the given distance</li>
<li>
<code>pct</code>: proportion of records smaller or equal the value in column cat for the selected distance</li>
</ul>
</li>
<li>
<code>false_zero</code>: number of cells that were perturbed to zero</li>
<li>
<code>false_nonzero</code>: number of cells that were initially zero but have been perturbed to a number different from zero</li>
</ul>
</div>
<div id="perturbing-continuously-scaled-variables" class="section level3">
<h3 class="hasAnchor">
<a href="#perturbing-continuously-scaled-variables" class="anchor"></a>Perturbing continuously scaled variables</h3>
<p>The perturbation of magnitude tables is currently in development and will be available in future versions of the <code>cellKey</code> package.</p>
<p>Finally we note that there are <code>print</code> and <code>summary</code> methods implemented for objects created with from <code><a href="../reference/cellkey_pkg.html">ck_setup()</a></code> which can be used as shown below:</p>
<p>The <code><a href="https://rdrr.io/r/base/print.html">print()</a></code>-method shows the dimension of the table as well as the variables that are (or possibly can be) perturbed. It is also displayed if the table was constructed using weights.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" data-line-number="1">tab<span class="op">$</span><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>() <span class="co"># same as (print(tab))</span></a></code></pre></div>
<pre><code>## ── Table Information ──────────────────────────────────────────────────────
## ✔ 21 cells in 2 dimensions ('sex', 'age')
## ✔ weights: yes
## ── Tabulated / Perturbed countvars ────────────────────────────────────────
## ☒ 'total' (perturbed)
## ☒ 'cnt_males' (perturbed)
## ☐ 'cnt_highincome'</code></pre>
<p>The <code>summary</code>-method shows some utility statistics for already perturbed variables as shown below:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" data-line-number="1">tab<span class="op">$</span><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>()</a></code></pre></div>
<pre><code>## ┌──────────────────────────────────────────────┐
## │Utility measures for perturbed count variables│
## └──────────────────────────────────────────────┘
## ── Distribution statistics of perturbations ───────────────────────────────
##     countvar Min Q10 Q20 Q30 Q40 Mean Median Q60 Q70 Q80 Q90 Q95 Q99 Max
## 1:     total  -3  -1  -1   0   0 0.00      0   0   0   1   1   1 2.6   3
## 2: cnt_males  -2  -2  -1  -1   0 0.19      0   0   0   0   3   5 5.0   5
## 
## ── Distance-based measures ────────────────────────────────────────────────
## ✔ Variable: 'total'
## 
##       what    d1    d2    d3
##  1:    Min 0.000 0.000 0.000
##  2:    Q10 0.000 0.000 0.000
##  3:    Q20 0.000 0.000 0.000
##  4:    Q30 0.000 0.000 0.000
##  5:    Q40 0.000 0.000 0.000
##  6:   Mean 0.667 0.002 0.017
##  7: Median 0.000 0.000 0.000
##  8:    Q60 1.000 0.001 0.016
##  9:    Q70 1.000 0.002 0.021
## 10:    Q80 1.000 0.002 0.031
## 11:    Q90 1.000 0.006 0.039
## 12:    Q95 3.000 0.012 0.054
## 13:    Q99 3.000 0.015 0.096
## 14:    Max 3.000 0.015 0.107
## 
## ✔ Variable: 'cnt_males'
## 
##       what    d1    d2    d3
##  1:    Min 0.000 0.000 0.000
##  2:    Q10 0.000 0.000 0.000
##  3:    Q20 0.000 0.000 0.000
##  4:    Q30 0.000 0.000 0.000
##  5:    Q40 0.000 0.000 0.000
##  6:   Mean 1.333 0.018 0.051
##  7: Median 1.000 0.001 0.021
##  8:    Q60 1.000 0.003 0.042
##  9:    Q70 2.000 0.004 0.047
## 10:    Q80 2.000 0.012 0.055
## 11:    Q90 3.000 0.026 0.178
## 12:    Q95 5.000 0.143 0.196
## 13:    Q99 5.000 0.143 0.196
## 14:    Max 5.000 0.143 0.196</code></pre>
</div>
</div>
<div id="summary" class="section level2">
<h2 class="hasAnchor">
<a href="#summary" class="anchor"></a>Summary</h2>
<p>The package is <em>“work in progress”</em> and therefore, suggestions and/or bugreports are welcome. Please feel free to file an issue at <a href="https://github.com/sdcTools/cellKey/issues"><strong>our issue tracker</strong></a> or contribute to the package by filing a <a href="https://github.com/sdcTools/cellKey/pulls"><strong>pull request</strong></a> against the master branch.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#introduction">Introduction</a><ul class="nav nav-pills nav-stacked">
<li><a href="#installation">Installation</a></li>
      <li><a href="#main-features">Main Features</a></li>
      <li><a href="#an-example">An Example</a></li>
      <li><a href="#summary">Summary</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Bernhard Meindl.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.9100.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
